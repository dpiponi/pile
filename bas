10DIM II(3), BB(3), D(3), L(3), SS(2)
20FOR I=0 TO 1
30DIM P(-1)
40A=P
50PRINT "ASSEMBLING..."
60PRINT $21
70REM #80 WORKING ADDRESS
80REM #84 STACK POINTER
90REM #88 ADDRESS OF ROUTINE
100REM #5000 STACK
110REM  #5000 WORKING ADDRESS LB
120REM  #5001 WORKING ADDRESS HB
130REM  #5002 ROUTINE ADDRESS LB
140REM  #5003 ROUTINE ADDRESS HB
150REM  #5004 ...
160[
170:SS1 
180CLC BUMP UP STACK BY 16
190LDA #84
200ADC @#10
210STA #84
220LDA #85
230ADC @#0
240STA #85
250:SS0
260LDA #85 MAIN ENTRY POINT
270CMP @#50
280BCS SS2
290RTS
300:SS2
310LDY @0 FETCH WORKING ADDRESS
320LDA (#84), Y
330STA #80
340INY
350LDA (#84), Y
360STA #81
370INY FETCH ROUTINE ADDRESS
380LDA (#84), Y
390STA #88
400INY
410LDA (#84), Y
420STA #89
430SEC DECREMENT STACK POINTER
440LDA #84
450SBC @#4
460STA #84
470LDA #85
480SBC @#0
490STA #85
500JMP (#88)
510:II0
520LDY @0
530LDA (#80),Y
540CLC
550ADC @#01
560TAX
570AND @#03
580BEQ BB0
590TXA
600STA (#80),Y
610JMPSS0
620:BB0
630LDA (#80),Y
640AND @(#FF:#03)
650STA (#80),Y
660LDY @4
670]
680!D=0;!L=II1;GOSUBa
690!D=-32;!L=II0;GOSUBa
700!D=32;!L=II0;GOSUBa
710!D=1;!L=II3;GOSUBa
720[
730JMPSS1
740:II1
750LDY @0
760LDA (#80),Y
770CLC
780ADC @#04
790TAX
800AND @#0C
810BEQ BB1
820TXA
830STA (#80),Y
840JMPSS0
850:BB1
860LDA (#80),Y
870AND @(#FF:#0C)
880STA (#80),Y
890LDY @4
900]
910REM PUSH 4 NEIGHBOURS
920!D=0;!L=II2;GOSUBa
930!D=-32;!L=II1;GOSUBa
940!D=32;!L=II1;GOSUBa
950!D=0;!L=II0;GOSUBa
960[
970JMPSS1
980:II2
990LDY @0
1000LDA (#80),Y
1010CLC
1020ADC @#10
1030TAX
1040AND @#30
1050BEQ BB2
1060TXA
1070STA (#80),Y
1080JMPSS0
1090:BB2
1100LDA (#80),Y
1110AND @(#FF:#30)
1120STA (#80),Y
1130LDY @4
1140]
1150!D=0;!L=II3;GOSUBa
1160!D=-32;!L=II2;GOSUBa
1170!D=32;!L=II2;GOSUBa
1180!D=0;!L=II1;GOSUBa
1190[
1200JMPSS1
1210:II3
1220LDY @0
1230LDA (#80),Y
1240CLC
1250ADC @#40
1260TAX
1270AND @#C0
1280BEQ BB3
1290TXA
1300STA (#80),Y
1310JMPSS0
1320:BB3
1330LDA (#80),Y
1340AND @(#FF:#C0)
1350STA (#80),Y
1360LDY @4
1370]
1380!D=-1;!L=II0;GOSUBa
1390!D=-32;!L=II3;GOSUBa
1400!D=32;!L=II3;GOSUBa
1410!D=0;!L=II2;GOSUBa
1420[
1430JMPSS1
1440]
1450PRINT $6
1460NEXT
1470CLEAR 4
1480COLOUR 0
1490REM END
1500sREM Seed
1510FORI=1TO10000
1520!#5000 = #8000+192/2*32+16
1530!#5002 = II0
1540REM STACK POINTER
1550!#84 = #00
1560!#85 = #50
1570LINKSS0
1580NEXTI
1590END
1600a[
1610CLC
1620LDA #80
1630ADC @(D?0)
1640STA (#84),Y
1650INY
1660LDA #81
1670ADC @(D?1)
1680STA (#84),Y
1690INY
1700LDA @(L?0)
1710STA (#84),Y
1720INY
1730LDA @(L?1)
1740STA (#84),Y
1750INY
1760]
1770RETURN
