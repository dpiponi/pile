10DIM II(3), BB(3), D(3), L(3), SS(2)
20FOR I=0 TO 1
30DIM P(-1)
40A=P
50PRINT $21
60REM #80 WORKING ADDRESS
70REM #84 STACK POINTER
80REM #88 ADDRESS OF ROUTINE
90REM #5000 STACK
100REM  #5000 WORKING ADDRESS LB
110REM  #5001 WORKING ADDRESS HB
120REM  #5002 ROUTINE ADDRESS LB
130REM  #5003 ROUTINE ADDRESS HB
140REM  #5004 ...
150[
160:SS1 
170CLC BUMP UP STACK BY 16
180LDA #84
190ADC @#10
200STA #84
210LDA #85
220ADC @#0
230STA #85
240:SS0
250LDA #85 MAIN ENTRY POINT
260CMP @#50
270BCS SS2
280RTS
290:SS2
300LDY @0 FETCH WORKING ADDRESS
310LDA (#84), Y
320STA #80
330INY
340LDA (#84), Y
350STA #81
360INY FETCH ROUTINE ADDRESS
370LDA (#84), Y
380STA #88
390INY
400LDA (#84), Y
410STA #89
420SEC DECREMENT STACK POINTER
430LDA #84
440SBC @#4
450STA #84
460LDA #85
470SBC @#0
480STA #85
490JMP (#88)
500:II0
510LDY @0
520LDA (#80),Y
530CLC
540ADC @#01
550TAX
560AND @#03
570BEQ BB0
580TXA
590STA (#80),Y
600JMPSS0
610:BB0
620LDA (#80),Y
630AND @(#FF:#03)
640STA (#80),Y
650LDY @4
660]
670!D=0;!L=II1;GOSUBa
680!D=-32;!L=II0;GOSUBa
690!D=32;!L=II0;GOSUBa
700!D=1;!L=II3;GOSUBa
710[
720JMPSS1
730:II1
740LDY @0
750LDA (#80),Y
760CLC
770ADC @#04
780TAX
790AND @#0C
800BEQ BB1
810TXA
820STA (#80),Y
830JMPSS0
840:BB1
850LDA (#80),Y
860AND @(#FF:#0C)
870STA (#80),Y
880LDY @4
890]
900REM PUSH 4 NEIGHBOURS
910!D=0;!L=II2;GOSUBa
920!D=-32;!L=II1;GOSUBa
930!D=32;!L=II1;GOSUBa
940!D=0;!L=II0;GOSUBa
950[
960JMPSS1
970:II2
980LDY @0
990LDA (#80),Y
1000CLC
1010ADC @#10
1020TAX
1030AND @#30
1040BEQ BB2
1050TXA
1060STA (#80),Y
1070JMPSS0
1080:BB2
1090LDA (#80),Y
1100AND @(#FF:#30)
1110STA (#80),Y
1120LDY @4
1130]
1140!D=0;!L=II3;GOSUBa
1150!D=-32;!L=II2;GOSUBa
1160!D=32;!L=II2;GOSUBa
1170!D=0;!L=II1;GOSUBa
1180[
1190JMPSS1
1200:II3
1210LDY @0
1220LDA (#80),Y
1230CLC
1240ADC @#40
1250TAX
1260AND @#C0
1270BEQ BB3
1280TXA
1290STA (#80),Y
1300JMPSS0
1310:BB3
1320LDA (#80),Y
1330AND @(#FF:#C0)
1340STA (#80),Y
1350LDY @4
1360]
1370!D=-1;!L=II0;GOSUBa
1380!D=-32;!L=II3;GOSUBa
1390!D=32;!L=II3;GOSUBa
1400!D=0;!L=II2;GOSUBa
1410[
1420JMPSS1
1430]
1440PRINT $6
1450NEXT
1460CLEAR 4
1470COLOUR 0
1480END
1490sREM Seed
1500FORI=1TO10000
1510!#5000 = #8000+192/2*32+16
1520!#5002 = II0
1530REM STACK POINTER
1540!#84 = #00
1550!#85 = #50
1560LINKSS0
1570NEXTI
1580END
1590a[
1600CLC
1610LDA #80
1620ADC @(D?0)
1630STA (#84),Y
1640INY
1650LDA #81
1660ADC @(D?1)
1670STA (#84),Y
1680INY
1690LDA @(L?0)
1700STA (#84),Y
1710INY
1720LDA @(L?1)
1730STA (#84),Y
1740INY
1750]
1760RETURN
